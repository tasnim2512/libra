# Libra ShikiCode åŒ…

Libra ShikiCode æ˜¯ä¸€ä¸ªåŸºäº **Shiki** æ„å»ºçš„ç°ä»£åŒ–ä»£ç ç¼–è¾‘å™¨ç»„ä»¶ï¼Œä¸º Web åº”ç”¨æä¾›é«˜æ€§èƒ½çš„è¯­æ³•é«˜äº®å’Œä»£ç ç¼–è¾‘åŠŸèƒ½ã€‚è¯¥åŒ…é‡‡ç”¨å·¥å‚æ¨¡å¼è®¾è®¡ï¼Œé€šè¿‡ä¸°å¯Œçš„æ’ä»¶ç³»ç»Ÿå®ç°è‡ªåŠ¨ç¼©è¿›ã€æ‹¬å·è‡ªåŠ¨é—­åˆã€æ³¨é‡Šåˆ‡æ¢ç­‰ä¸“ä¸šä»£ç ç¼–è¾‘å™¨åŠŸèƒ½ã€‚å®ƒæ”¯æŒ Shiki æ‰€æœ‰ç¼–ç¨‹è¯­è¨€å’Œä¸»é¢˜ï¼Œæä¾›ä¸ VS Code ä¸€è‡´çš„è¯­æ³•é«˜äº®æ•ˆæœï¼ŒåŒæ—¶ä¿æŒè½»é‡çº§å’Œé«˜åº¦å¯å®šåˆ¶çš„ç‰¹æ€§ã€‚

## ğŸš€ æ ¸å¿ƒç‰¹æ€§

### âœ¨ è¯­æ³•é«˜äº®
- **å®Œæ•´è¯­è¨€æ”¯æŒ**ï¼šæ”¯æŒ Shiki æ‰€æœ‰å†…ç½®ç¼–ç¨‹è¯­è¨€çš„ç²¾ç¡®è¯­æ³•é«˜äº®
- **VS Code çº§åˆ«çš„é«˜äº®æ•ˆæœ**ï¼šåŸºäº TextMate è¯­æ³•å’Œ Shiki å¼•æ“
- **ä¸»é¢˜ç³»ç»Ÿ**ï¼šæ”¯æŒæ‰€æœ‰ Shiki å†…ç½®ä¸»é¢˜ï¼ŒåŠ¨æ€ä¸»é¢˜åˆ‡æ¢
- **åŠ¨æ€åŠ è½½**ï¼šè¯­è¨€å’Œä¸»é¢˜æŒ‰éœ€åŠ è½½ï¼Œä¼˜åŒ–æ€§èƒ½

### ğŸ”§ ç¼–è¾‘åŠŸèƒ½
- **æ™ºèƒ½ç¼©è¿›**ï¼šåŸºäº Tab å’Œç©ºæ ¼çš„æ™ºèƒ½ç¼©è¿›ç®¡ç†ï¼Œæ”¯æŒè‡ªåŠ¨æ£€æµ‹
- **æ‹¬å·è‡ªåŠ¨é—­åˆ**ï¼šæ”¯æŒå¤šç§è¯­è¨€çš„æ‹¬å·ã€å¼•å·ç­‰æˆå¯¹ç¬¦å·è‡ªåŠ¨é—­åˆ
- **è¡Œå·æ˜¾ç¤º**ï¼šå¯é…ç½®çš„è¡Œå·æ˜¾ç¤ºåŠŸèƒ½ï¼Œå¸¦è§†è§‰æ ·å¼
- **ä»£ç æ³¨é‡Š**ï¼šæ”¯æŒå•è¡Œå’Œå¤šè¡Œæ³¨é‡Šåˆ‡æ¢ï¼Œè¯­è¨€ç‰¹å®šçš„æ³¨é‡Šè§„åˆ™

### ğŸ§© æ’ä»¶ç³»ç»Ÿ
- **å‡½æ•°å¼æ’ä»¶æ¶æ„**ï¼šåŸºäºç”Ÿå‘½å‘¨æœŸçš„æ’ä»¶ç®¡ç†æœºåˆ¶
- **å†…ç½®æ ¸å¿ƒæ’ä»¶**ï¼šautoloadã€closing_pairsã€commentsã€tab
- **è‡ªå®šä¹‰æ’ä»¶**ï¼šæ”¯æŒå¼€å‘è‡ªå®šä¹‰åŠŸèƒ½æ’ä»¶ï¼Œæä¾›å®Œæ•´çš„ API
- **æ’ä»¶ç»„åˆ**ï¼šæ”¯æŒå¤šæ’ä»¶ç»„åˆå’Œé…ç½®

### âš¡ æ€§èƒ½ä¼˜åŒ–
- **åŒå±‚æ¸²æŸ“æ¶æ„**ï¼šé€æ˜ textarea è¾“å…¥å±‚ + div æ˜¾ç¤ºå±‚çš„é«˜æ•ˆæ¶æ„
- **äº‹ä»¶åŒæ­¥**ï¼šè¾“å…¥å’Œæ»šåŠ¨äº‹ä»¶çš„ç²¾ç¡®åŒæ­¥æœºåˆ¶
- **å†…å­˜ç®¡ç†**ï¼šæä¾›å®Œæ•´çš„é”€æ¯å’Œæ¸…ç†æœºåˆ¶
- **CSS å˜é‡**ï¼šåŸºäº CSS è‡ªå®šä¹‰å±æ€§çš„æ ·å¼ç³»ç»Ÿ

## ğŸ“ é¡¹ç›®ç»“æ„

```bash
packages/shikicode/
â”œâ”€â”€ lib/                       # æ„å»ºäº§ç‰©
â”‚   â”œâ”€â”€ index.js              # ä¸»è¦å¯¼å‡ºæ„å»ºæ–‡ä»¶
â”‚   â”œâ”€â”€ index.d.ts            # TypeScript ç±»å‹å®šä¹‰
â”‚   â””â”€â”€ plugins/              # æ’ä»¶ç³»ç»Ÿæ„å»ºäº§ç‰©
â”œâ”€â”€ src/                       # æºä»£ç ç›®å½•
â”‚   â”œâ”€â”€ index.ts              # åŒ…å¯¼å‡ºå…¥å£ï¼Œé‡æ–°å¯¼å‡º core.ts
â”‚   â”œâ”€â”€ core.ts               # æ ¸å¿ƒç¼–è¾‘å™¨å®ç°ï¼Œå·¥å‚å‡½æ•°å’Œæ¥å£
â”‚   â”œâ”€â”€ scroll.ts             # æ»šåŠ¨åŒæ­¥åŠŸèƒ½ï¼Œè¾“å…¥è¾“å‡ºå±‚åŒæ­¥
â”‚   â”œâ”€â”€ style.ts              # CSS æ ·å¼æ³¨å…¥å’Œç®¡ç†
â”‚   â””â”€â”€ plugins/              # æ’ä»¶ç³»ç»Ÿ
â”‚       â”œâ”€â”€ index.ts          # æ’ä»¶ç±»å‹å®šä¹‰å’Œå¯¼å‡º
â”‚       â”œâ”€â”€ autoload.ts       # è‡ªåŠ¨åŠ è½½è¯­è¨€å’Œä¸»é¢˜
â”‚       â”œâ”€â”€ closing_pairs.ts  # æ‹¬å·ã€å¼•å·è‡ªåŠ¨é—­åˆ
â”‚       â”œâ”€â”€ comments.ts       # è¡Œæ³¨é‡Šå’Œå—æ³¨é‡Šåˆ‡æ¢
â”‚       â”œâ”€â”€ tab.ts            # Tab ç¼©è¿›ã€Enter æ™ºèƒ½æ¢è¡Œ
â”‚       â””â”€â”€ common.ts         # æ’ä»¶å·¥å…·å‡½æ•°
â”œâ”€â”€ index.html                # æ¼”ç¤ºé¡µé¢å’Œæµ‹è¯•ç¯å¢ƒ
â”œâ”€â”€ package.json              # åŒ…ä¾èµ–ä¸è„šæœ¬å®šä¹‰
â”œâ”€â”€ tsconfig.json             # TypeScript é…ç½®
â””â”€â”€ tsup.config.ts            # æ„å»ºé…ç½®
```

## ğŸ› ï¸ æŠ€æœ¯å®ç°

### æ ¸å¿ƒæŠ€æœ¯æ ˆ
- **Shiki v3.7.0**ï¼šTextMate è¯­æ³•çš„ JavaScript å®ç°ï¼Œæä¾› VS Code çº§åˆ«çš„è¯­æ³•é«˜äº®
- **TypeScript**ï¼šç±»å‹å®‰å…¨çš„å¼€å‘ä½“éªŒï¼Œä¸¥æ ¼æ¨¡å¼
- **åŸç”Ÿ DOM API**ï¼šæ— æ¡†æ¶ä¾èµ–ï¼Œç›´æ¥ä½¿ç”¨æµè§ˆå™¨ API
- **CSS Variables**ï¼š`--fg`ã€`--bg`ã€`--tab-size` ç­‰è‡ªå®šä¹‰å±æ€§

### æ¶æ„è®¾è®¡
- **åŒå±‚æ¸²æŸ“**ï¼šé€æ˜çš„ `textarea` ç”¨äºè¾“å…¥ï¼Œ`div` ç”¨äºè¯­æ³•é«˜äº®æ˜¾ç¤º
- **äº‹ä»¶åŒæ­¥**ï¼š`input` äº‹ä»¶è§¦å‘é‡æ–°æ¸²æŸ“ï¼Œ`scroll` äº‹ä»¶åŒæ­¥æ»šåŠ¨ä½ç½®
- **å·¥å‚æ¨¡å¼**ï¼š`shikiCode()` å·¥å‚å‡½æ•°æä¾›é“¾å¼é…ç½®API
- **æ’ä»¶ç³»ç»Ÿ**ï¼šå‡½æ•°å¼æ’ä»¶ï¼Œè¿”å›æ¸…ç†å‡½æ•°ï¼Œæ”¯æŒåŠ¨æ€æ·»åŠ å’Œç§»é™¤
- **æ ·å¼éš”ç¦»**ï¼šé€šè¿‡å“ˆå¸Œå€¼é¿å…æ ·å¼å†²çªï¼ŒåŠ¨æ€æ³¨å…¥CSSè§„åˆ™

## ğŸš€ å®‰è£…ä¸ä½¿ç”¨

### åŒ…ä¾èµ–

åœ¨ Libra é¡¹ç›®ä¸­ï¼Œshikicode ä½œä¸ºå†…éƒ¨åŒ…ä½¿ç”¨ï¼š

```json
{
  "name": "@libra/shikicode",
  "version": "0.0.0",
  "devDependencies": {
    "shiki": "^3.7.0"
  }
}
```

### åŸºç¡€ç”¨æ³•

```typescript
import { createHighlighter } from 'shiki'
import { shikiCode } from '@libra/shikicode'

// åˆ›å»ºé«˜äº®å™¨å®ä¾‹
const highlighter = await createHighlighter({
  langs: ['javascript', 'typescript'],
  themes: ['github-dark', 'github-light']
})

// åˆ›å»ºç¼–è¾‘å™¨å®ä¾‹
const editor = shikiCode()
  .withOptions({
    lineNumbers: 'on',     // æ˜¾ç¤ºè¡Œå·
    readOnly: false,       // å¯ç¼–è¾‘
    tabSize: 4,           // Tab å¤§å°ä¸º 4 ä¸ªç©ºæ ¼
    insertSpaces: true    // ä½¿ç”¨ç©ºæ ¼è€Œé Tab å­—ç¬¦
  })
  .create(containerElement, highlighter, {
    value: 'console.log("Hello, ShikiCode!")',
    language: 'javascript',
    theme: 'github-dark'
  })

// è·å–å’Œè®¾ç½®å†…å®¹
console.log(editor.value) // è·å–å½“å‰ä»£ç 
editor.value = 'const message = "New code"' // è®¾ç½®æ–°ä»£ç å¹¶é‡æ–°æ¸²æŸ“
```

### é«˜çº§é…ç½®

```typescript
import { shikiCode } from '@libra/shikicode'
import { 
  autoload, 
  hookClosingPairs, 
  hookTab, 
  comments 
} from '@libra/shikicode/plugins'

const editor = shikiCode()
  .withOptions({
    lineNumbers: 'on',
    readOnly: false,
    tabSize: 4,
    insertSpaces: true
  })
  .withPlugins(
    // è‡ªåŠ¨åŠ è½½ç¼ºå¤±çš„è¯­è¨€å’Œä¸»é¢˜
    autoload,
    // è‡ªåŠ¨é—­åˆæ‹¬å·ï¼ˆæ— å‚æ•°ä½¿ç”¨é»˜è®¤è§„åˆ™ï¼‰
    hookClosingPairs(),
    // Tab ç¼©è¿›æ”¯æŒï¼ŒEnter æ™ºèƒ½æ¢è¡Œ
    hookTab,
    // æ³¨é‡Šåˆ‡æ¢ï¼ˆCtrl/Cmd + /ï¼‰
    comments({ 
      language: 'typescript', 
      lineComment: '//', 
      blockComment: ['/*', '*/'],
      insertSpace: true
    })
  )
  .create(container, highlighter, {
    value: initialCode,
    language: 'typescript',
    theme: 'github-dark'
  })

// åŠ¨æ€æ›´æ–°é€‰é¡¹
editor.updateOptions({
  theme: 'github-light',
  language: 'python'
})

// åŠ¨æ€æ·»åŠ æ’ä»¶
editor.addPlugin(autoload)

// æ¸…ç†ç¼–è¾‘å™¨
editor.dispose()
```

## ğŸ§© æ’ä»¶ç³»ç»Ÿ

### å†…ç½®æ’ä»¶

#### 1. AutoLoad æ’ä»¶ (`autoload`)
è‡ªåŠ¨åŠ è½½ç¼ºå¤±çš„è¯­è¨€å’Œä¸»é¢˜ï¼Œå°† `updateOptions` è½¬æ¢ä¸ºå¼‚æ­¥æ–¹æ³•ï¼š

```typescript
import { autoload } from '@libra/shikicode/plugins'

editor.addPlugin(autoload)

// ç°åœ¨ updateOptions æ˜¯å¼‚æ­¥çš„
await editor.updateOptions({
  language: 'rust',  // è‡ªåŠ¨åŠ è½½ rust è¯­è¨€
  theme: 'monokai'   // è‡ªåŠ¨åŠ è½½ monokai ä¸»é¢˜
})
```

#### 2. æ‹¬å·è‡ªåŠ¨é—­åˆæ’ä»¶ (`hookClosingPairs`)
æ”¯æŒå¤šç§è¯­è¨€çš„æ‹¬å·ã€å¼•å·è‡ªåŠ¨é—­åˆï¼š

```typescript
import { hookClosingPairs } from '@libra/shikicode/plugins'

// ä½¿ç”¨é»˜è®¤é…ç½®ï¼ˆæ”¯æŒæ‰€æœ‰å†…ç½®è¯­è¨€è§„åˆ™ï¼‰
editor.addPlugin(hookClosingPairs())

// è‡ªå®šä¹‰è¯­è¨€è§„åˆ™
editor.addPlugin(hookClosingPairs({
  language: 'javascript',
  pairs: [
    ['(', ')'],
    ['[', ']'],
    ['{', '}'],
    ['"', '"'],
    ["'", "'"],
    ['`', '`']
  ]
}))
```

**åŠŸèƒ½ç‰¹æ€§ï¼š**
- è¾“å…¥å·¦æ‹¬å·æ—¶è‡ªåŠ¨æ’å…¥å³æ‹¬å·
- é€‰ä¸­æ–‡æœ¬æ—¶ç”¨æ‹¬å·åŒ…å›´
- Backspace æ—¶åˆ é™¤æˆå¯¹æ‹¬å·
- è¾“å…¥å³æ‹¬å·æ—¶è·³è¿‡å·²å­˜åœ¨çš„å³æ‹¬å·

#### 3. æ³¨é‡Šåˆ‡æ¢æ’ä»¶ (`comments`)
æ”¯æŒè¡Œæ³¨é‡Šå’Œå—æ³¨é‡Šçš„åˆ‡æ¢ï¼ˆCtrl/Cmd + /ï¼‰ï¼š

```typescript
import { comments } from '@libra/shikicode/plugins'

editor.addPlugin(comments({
  language: 'typescript',
  lineComment: '//',
  blockComment: ['/*', '*/'],
  insertSpace: true // æ³¨é‡Šç¬¦å·åæ’å…¥ç©ºæ ¼
}))
```

**åŠŸèƒ½ç‰¹æ€§ï¼š**
- å•è¡Œï¼šè‡ªåŠ¨æ³¨é‡Š/åæ³¨é‡Šå½“å‰è¡Œ
- å¤šè¡Œï¼šæ‰¹é‡æ³¨é‡Š/åæ³¨é‡Šé€‰ä¸­è¡Œ
- æ™ºèƒ½ç©ºæ ¼å¤„ç†

#### 4. Tab ç¼©è¿›æ’ä»¶ (`hookTab`)
æ™ºèƒ½ Tab ç¼©è¿›å’Œ Enter æ¢è¡Œï¼š

```typescript
import { hookTab } from '@libra/shikicode/plugins'

editor.addPlugin(hookTab)
```

**åŠŸèƒ½ç‰¹æ€§ï¼š**
- **Tab**ï¼šæ™ºèƒ½ç¼©è¿›ï¼Œå¤šè¡Œé€‰æ‹©æ—¶æ‰¹é‡ç¼©è¿›
- **Shift+Tab**ï¼šå‡å°‘ç¼©è¿›
- **Enter**ï¼šæ™ºèƒ½æ¢è¡Œï¼Œè‡ªåŠ¨ç»§æ‰¿å½“å‰è¡Œç¼©è¿›
- **Backspace**ï¼šåœ¨ç©ºç™½ç¬¦ä¸Šæ™ºèƒ½åˆ é™¤åˆ°ä¸Šä¸€ä¸ª Tab ä½ç½®
- **Escape**ï¼šå¤±ç„¦ç¼–è¾‘å™¨
- æ”¯æŒæ‹¬å·å†…æ¢è¡Œæ—¶è‡ªåŠ¨å¢åŠ ç¼©è¿›

### è‡ªå®šä¹‰æ’ä»¶å¼€å‘

æ’ä»¶æ˜¯æ¥æ”¶ç¼–è¾‘å™¨å®ä¾‹å’Œé€‰é¡¹ï¼Œè¿”å›æ¸…ç†å‡½æ•°çš„å‡½æ•°ï¼š

```typescript
import type { EditorPlugin, ShikiCode, EditorOptions } from '@libra/shikicode/plugins'

const myCustomPlugin: EditorPlugin = (editor: ShikiCode, options: EditorOptions) => {
  const handleKeydown = (e: KeyboardEvent) => {
    if (e.key === 'F1') {
      // è‡ªå®šä¹‰å¿«æ·é”®é€»è¾‘
      console.log('F1 pressed, current language:', options.language)
      console.log('Current value:', editor.value)
    }
  }

  // ç»‘å®šäº‹ä»¶åˆ°è¾“å…¥å…ƒç´ 
  editor.input.addEventListener('keydown', handleKeydown)

  // å¿…é¡»è¿”å›æ¸…ç†å‡½æ•°
  return () => {
    editor.input.removeEventListener('keydown', handleKeydown)
  }
}

// ä½¿ç”¨è‡ªå®šä¹‰æ’ä»¶
editor.addPlugin(myCustomPlugin)
```

**æ’ä»¶å¼€å‘è¦ç‚¹ï¼š**
- æ¥æ”¶ `ShikiCode` å®ä¾‹å’Œ `EditorOptions` é…ç½®
- å¯ä»¥è®¿é—® `editor.input`ï¼ˆtextareaï¼‰ã€`editor.output`ï¼ˆdivï¼‰ã€`editor.highlighter`
- å¿…é¡»è¿”å›æ¸…ç†å‡½æ•°ä»¥é¿å…å†…å­˜æ³„æ¼
- å¯ä»¥ç›‘å¬é”®ç›˜äº‹ä»¶ã€è¾“å…¥äº‹ä»¶ç­‰
- æ”¯æŒè®¿é—®å’Œä¿®æ”¹ç¼–è¾‘å™¨å†…å®¹

## ğŸ¨ ä¸»é¢˜å’Œæ ·å¼

### ä¸»é¢˜åˆ‡æ¢

```typescript
// åŠ¨æ€åˆ‡æ¢ä¸»é¢˜ï¼ˆç¡®ä¿ä¸»é¢˜å·²åŠ è½½ï¼‰
editor.updateOptions({
  theme: 'github-light'
})

// åŒæ—¶åˆ‡æ¢è¯­è¨€å’Œä¸»é¢˜
editor.updateOptions({
  language: 'python',
  theme: 'monokai'
})

// ä½¿ç”¨ autoload æ’ä»¶æ—¶è‡ªåŠ¨åŠ è½½
await editor.updateOptions({
  theme: 'material-theme-darker'  // è‡ªåŠ¨åŠ è½½æ–°ä¸»é¢˜
})
```

### CSS å˜é‡ç³»ç»Ÿ

ç¼–è¾‘å™¨ä½¿ç”¨ CSS è‡ªå®šä¹‰å±æ€§è¿›è¡Œæ ·å¼ç®¡ç†ï¼š

```css
/* å®¹å™¨çº§åˆ«çš„å˜é‡ */
.editor-container {
  --fg: #24292f;        /* å‰æ™¯è‰²ï¼ˆæ–‡å­—é¢œè‰²ï¼‰ */
  --bg: #ffffff;        /* èƒŒæ™¯è‰² */
  --tab-size: 4;        /* Tab å¤§å° */
  --font-family: 'JetBrains Mono', monospace;
}

/* è‡ªå®šä¹‰è¾“å…¥å±‚æ ·å¼ */
.shikicode.input {
  font-family: var(--font-family, monospace);
  font-size: 14px;
  line-height: 1.5;
  caret-color: var(--fg, black);
}

/* è‡ªå®šä¹‰è¡Œå·æ ·å¼ */
.shikicode.output.line-numbers .line::before {
  color: #6b7280;
  background-color: var(--bg);
  width: 5em;
  padding-right: 2em;
}

/* è°ƒæ•´è¡Œå·åŒºåŸŸå¤§å° */
.shikicode.input.line-numbers {
  padding-left: 5em;
}
```

## ğŸ“š API å‚è€ƒ

### ShikiCode æ¥å£

```typescript
interface ShikiCode {
  // DOM å…ƒç´ 
  readonly input: HTMLTextAreaElement      // é€æ˜è¾“å…¥å±‚
  readonly output: HTMLDivElement          // è¯­æ³•é«˜äº®æ˜¾ç¤ºå±‚
  readonly container: HTMLElement          // å®¹å™¨å…ƒç´ 
  
  // é«˜äº®å™¨å®ä¾‹
  readonly highlighter: Highlighter       // Shiki é«˜äº®å™¨
  
  // å†…å®¹ç®¡ç†
  value: string                           // è·å–/è®¾ç½®ç¼–è¾‘å™¨å†…å®¹
  forceRender(value?: string): void       // å¼ºåˆ¶é‡æ–°æ¸²æŸ“
  
  // é…ç½®æ›´æ–°
  updateOptions(options: UpdateOptions): void
  
  // æ’ä»¶ç®¡ç†
  addPlugin(plugin: EditorPlugin): void   // åŠ¨æ€æ·»åŠ æ’ä»¶
  
  // é”€æ¯ç¼–è¾‘å™¨
  dispose(): void                         // æ¸…ç†èµ„æºå’Œäº‹ä»¶ç›‘å¬å™¨
}
```

### å·¥å‚å‡½æ•°æ¥å£

```typescript
interface ShikiCodeFactory {
  create(domElement: HTMLElement, highlighter: Highlighter, options: InitOptions): ShikiCode
  withOptions(options: UpdateOptions): ShikiCodeFactory
  withPlugins(...plugins: readonly EditorPlugin[]): ShikiCodeFactory
}

// å·¥å‚å‡½æ•°
function shikiCode(): ShikiCodeFactory
```

### é…ç½®é€‰é¡¹

```typescript
interface EditorOptions extends IndentOptions {
  // è¡Œå·æ˜¾ç¤º
  lineNumbers: 'on' | 'off'
  
  // åªè¯»æ¨¡å¼
  readOnly: boolean
  
  // è¯­è¨€è®¾ç½®ï¼ˆæ”¯æŒ Shiki æ‰€æœ‰è¯­è¨€ + æ‰©å±•ï¼‰
  language: BundledLanguage | 'plaintext' | 'txt' | 'text' | 'plain' | (string & {})
  
  // ä¸»é¢˜è®¾ç½®ï¼ˆæ”¯æŒ Shiki æ‰€æœ‰ä¸»é¢˜ + 'none'ï¼‰
  theme: BundledTheme | 'none' | (string & {})
}

interface IndentOptions {
  // Tab å¤§å°ï¼ˆé»˜è®¤ 4ï¼‰
  tabSize: number
  
  // ä½¿ç”¨ç©ºæ ¼è€Œé Tab å­—ç¬¦ï¼ˆé»˜è®¤ trueï¼‰
  insertSpaces: boolean
}

// åˆå§‹åŒ–é€‰é¡¹
interface InitOptions extends Pick<EditorOptions, 'language' | 'theme'> {
  readonly value?: string
}

// æ›´æ–°é€‰é¡¹ï¼ˆæ‰€æœ‰å±æ€§å¯é€‰ï¼‰
interface UpdateOptions extends Partial<EditorOptions> {}
```

## ğŸ”§ å¼€å‘æŒ‡å—

### æœ¬åœ°å¼€å‘

åœ¨ Libra é¡¹ç›®æ ¹ç›®å½•è¿è¡Œï¼š

```bash
# å®‰è£…ä¾èµ–
bun install

# æ„å»º shikicode åŒ…
bun run build

# è¿è¡Œç±»å‹æ£€æŸ¥
bun run typecheck

# æ¸…ç†æ„å»ºäº§ç‰©
bun run clean
```

### åŒ…æ„å»º

ä½¿ç”¨ tsup è¿›è¡Œæ„å»ºï¼š

```bash
# packages/shikicode ç›®å½•ä¸‹
bun run build
```

æ„å»ºé…ç½® (`tsup.config.ts`)ï¼š
- è¾“å‡ºæ ¼å¼ï¼šESM
- ç›®æ ‡ï¼š`lib/` ç›®å½•
- ç±»å‹å®šä¹‰ï¼šè‡ªåŠ¨ç”Ÿæˆ `.d.ts` æ–‡ä»¶
- æ’ä»¶ç³»ç»Ÿï¼šç‹¬ç«‹æ‰“åŒ…ä¸º `plugins/` å­ç›®å½•

### æµ‹è¯•ç¼–è¾‘å™¨

æ‰“å¼€æ¼”ç¤ºé¡µé¢ï¼š

```bash
# åœ¨ packages/shikicode ç›®å½•ä¸‹å¯åŠ¨é™æ€æœåŠ¡å™¨
python -m http.server 8000
# æˆ–ä½¿ç”¨ bun
bun --bun vite

# è®¿é—® http://localhost:8000/index.html
```

### æ‰©å±•ç¼–è¾‘å™¨

#### æ·»åŠ æ–°è¯­è¨€æ”¯æŒ

```typescript
// æ‰‹åŠ¨åŠ è½½æ–°è¯­è¨€
await editor.highlighter.loadLanguage('rust')
editor.updateOptions({ language: 'rust' })

// ä½¿ç”¨ autoload æ’ä»¶è‡ªåŠ¨åŠ è½½
editor.addPlugin(autoload)
await editor.updateOptions({ language: 'rust' })  // è‡ªåŠ¨åŠ è½½
```

#### æ·»åŠ æ–°çš„æ‹¬å·é—­åˆè§„åˆ™

```typescript
import { hookClosingPairs } from '@libra/shikicode/plugins'

// ä¸ºè‡ªå®šä¹‰è¯­è¨€æ·»åŠ æ‹¬å·è§„åˆ™
editor.addPlugin(hookClosingPairs({
  language: 'my-language',
  pairs: [
    ['(', ')'],
    ['[', ']'],
    ['{', '}'],
    ['<', '>'],  // XML/HTML æ ‡ç­¾
    ['"', '"'],
    ["'", "'"]
  ]
}))
```

#### åˆ›å»ºè‡ªå®šä¹‰ä¸»é¢˜

```typescript
// åŠ è½½è‡ªå®šä¹‰ä¸»é¢˜å¯¹è±¡
await editor.highlighter.loadTheme({
  name: 'my-custom-theme',
  type: 'dark',
  colors: {
    'editor.background': '#1a1a1a',
    'editor.foreground': '#d4d4d4'
  },
  tokenColors: [
    {
      scope: ['comment'],
      settings: { foreground: '#6A9955' }
    }
  ]
})

editor.updateOptions({ theme: 'my-custom-theme' })
```

## ğŸ¯ è§£å†³çš„é—®é¢˜

### 1. é«˜è´¨é‡è¯­æ³•é«˜äº®
- **ç²¾ç¡®çš„è¯­æ³•è§£æ**ï¼šåŸºäº TextMate è¯­æ³•è§„åˆ™ï¼Œä¸ VS Code å®Œå…¨ä¸€è‡´
- **å®Œæ•´è¯­è¨€æ”¯æŒ**ï¼šæ”¯æŒ Shiki æ‰€æœ‰å†…ç½®è¯­è¨€ï¼Œæ— éœ€é¢å¤–é…ç½®
- **ä¸»é¢˜ä¸€è‡´æ€§**ï¼šä¸ VS Code ä¸»é¢˜å®Œå…¨å…¼å®¹ï¼Œæä¾›ä¸€è‡´çš„è§†è§‰ä½“éªŒ

### 2. Web å¹³å°ä»£ç ç¼–è¾‘
- **åŒå±‚æ¶æ„**ï¼šé€æ˜è¾“å…¥å±‚ + é«˜äº®æ˜¾ç¤ºå±‚ï¼Œè§£å†³æµè§ˆå™¨ç¼–è¾‘å™¨æŠ€æœ¯éš¾é¢˜
- **äº‹ä»¶åŒæ­¥**ï¼šç²¾ç¡®çš„è¾“å…¥ã€æ»šåŠ¨äº‹ä»¶åŒæ­¥æœºåˆ¶
- **æ— æ¡†æ¶ä¾èµ–**ï¼šçº¯ DOM API å®ç°ï¼Œå¯é›†æˆåˆ°ä»»ä½•å‰ç«¯æŠ€æœ¯æ ˆ

### 3. å¯æ‰©å±•æ€§å’Œå®šåˆ¶åŒ–
- **æ’ä»¶ç³»ç»Ÿ**ï¼šå‡½æ•°å¼æ’ä»¶æ¶æ„ï¼Œæ”¯æŒè‡ªå®šä¹‰ç¼–è¾‘è¡Œä¸º
- **ç±»å‹å®‰å…¨**ï¼šå®Œæ•´çš„ TypeScript ç±»å‹å®šä¹‰å’Œæ¥å£
- **CSS å˜é‡**ï¼šåŸºäº CSS è‡ªå®šä¹‰å±æ€§çš„æ ·å¼ç³»ç»Ÿ

### 4. æ€§èƒ½ä¼˜åŒ–
- **æŒ‰éœ€åŠ è½½**ï¼šè¯­è¨€å’Œä¸»é¢˜åŠ¨æ€åŠ è½½ï¼Œå‡å°‘åˆå§‹åŒ…ä½“ç§¯
- **å†…å­˜ç®¡ç†**ï¼šå®Œæ•´çš„é”€æ¯æœºåˆ¶ï¼Œé¿å…å†…å­˜æ³„æ¼
- **æ ·å¼éš”ç¦»**ï¼šå“ˆå¸ŒåŒ–æ ·å¼ï¼Œé¿å…å…¨å±€æ ·å¼å†²çª

## ğŸ“– ç›¸å…³èµ„æº

- **Shiki å®˜æ–¹æ–‡æ¡£**: [https://shiki.style/](https://shiki.style/)
- **TextMate è¯­æ³•è§„èŒƒ**: [https://macromates.com/manual/en/language_grammars](https://macromates.com/manual/en/language_grammars)
- **VS Code ä¸»é¢˜å¼€å‘**: [https://code.visualstudio.com/api/extension-guides/color-theme](https://code.visualstudio.com/api/extension-guides/color-theme)
- **åŸå§‹çµæ„Ÿé¡¹ç›®**: [magic-akari/shikicode](https://github.com/magic-akari/shikicode)

## ğŸ› ï¸ å†…éƒ¨å®ç°ç»†èŠ‚

### æ ¸å¿ƒæ–‡ä»¶è¯´æ˜

| æ–‡ä»¶ | åŠŸèƒ½ | ä¸»è¦å¯¼å‡º |
|------|------|----------|
| `core.ts` | æ ¸å¿ƒç¼–è¾‘å™¨å®ç° | `shikiCode`, `ShikiCode`, `EditorOptions` |
| `scroll.ts` | æ»šåŠ¨åŒæ­¥ | `hookScroll` |
| `style.ts` | æ ·å¼æ³¨å…¥ | `injectStyle` |
| `plugins/index.ts` | æ’ä»¶ç±»å‹å®šä¹‰ | `EditorPlugin`, `IDisposable` |
| `plugins/autoload.ts` | è‡ªåŠ¨åŠ è½½ | `autoload` |
| `plugins/closing_pairs.ts` | æ‹¬å·é—­åˆ | `hookClosingPairs`, é»˜è®¤è¯­è¨€è§„åˆ™ |
| `plugins/comments.ts` | æ³¨é‡Šåˆ‡æ¢ | `comments` |
| `plugins/tab.ts` | ç¼©è¿›ç®¡ç† | `hookTab`, `indentText`, `outdentText` |
| `plugins/common.ts` | å·¥å…·å‡½æ•° | `setRangeText`, `visibleWidthFromLeft` |

### æ„å»ºå’Œå¯¼å‡º

```json
{
  "exports": {
    ".": {
      "types": "./lib/index.d.ts",
      "default": "./lib/index.js"
    },
    "./plugins": {
      "types": "./lib/plugins/index.d.ts",
      "default": "./lib/plugins/index.js"
    }
  }
}
```
 